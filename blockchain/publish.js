var Web3 = require("web3");
var web3 = new Web3(new Web3.providers.HttpProvider("http://localhost:8545"));

var acc = web3.eth.accounts[0]; //get the first account

//Store this contract's compiled bytecode and ABI
var abi = [{"constant":true,"inputs":[{"name":"","type":"bytes32"},{"name":"","type":"uint256"}],"name":"votes","outputs":[{"name":"votedFor","type":"uint256"},{"name":"votedAgainst","type":"uint256"},{"name":"target","type":"uint256"},{"name":"result","type":"bool"},{"name":"completed","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"orcidStr","type":"string"},{"name":"id","type":"bytes32"}],"name":"startReproduce","outputs":[],"payable":true,"stateMutability":"payable","type":"function"},{"constant":true,"inputs":[{"name":"id","type":"bytes32"},{"name":"adr","type":"address"}],"name":"getStake","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"bytes32"}],"name":"researches","outputs":[{"name":"researcher","type":"address"},{"name":"paperURL","type":"string"},{"name":"title","type":"string"},{"name":"id","type":"bytes32"},{"name":"stakedAmount","type":"uint256"},{"name":"votesLength","type":"uint256"},{"name":"isLocked","type":"bool"},{"name":"reproducer","type":"address"},{"name":"reproducedURL","type":"string"},{"name":"state","type":"uint8"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"getResearchKeys","outputs":[{"name":"","type":"bytes32[]"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"orcidStr","type":"string"},{"name":"id","type":"bytes32"}],"name":"stakeResearch","outputs":[],"payable":true,"stateMutability":"payable","type":"function"},{"constant":false,"inputs":[{"name":"id","type":"bytes32"}],"name":"submitReproduction","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"researchKeys","outputs":[{"name":"","type":"bytes32"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"id","type":"bytes32"},{"name":"voteFor","type":"bool"}],"name":"vote","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"addressToOrcid","outputs":[{"name":"","type":"bytes32"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"id","type":"bytes32"}],"name":"getResearchStakers","outputs":[{"name":"","type":"address[]"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"orcidStr","type":"string"},{"name":"paperURL","type":"string"},{"name":"title","type":"string"}],"name":"publishResearch","outputs":[],"payable":true,"stateMutability":"payable","type":"function"},{"constant":true,"inputs":[{"name":"id","type":"bytes32"},{"name":"voteIdx","type":"uint256"},{"name":"adr","type":"address"}],"name":"getVote","outputs":[{"name":"","type":"uint8"}],"payable":false,"stateMutability":"view","type":"function"},{"inputs":[],"payable":true,"stateMutability":"payable","type":"constructor"}];
var bytecode = "6080604052670de0b6b3a7640000600455670de0b6b3a7640000600555670de0b6b3a764000060065561175a806100376000396000f3006080604052600436106100c45763ffffffff7c01000000000000000000000000000000000000000000000000000000006000350416630847a4fb81146100c95780632250214d146101135780635399ab4c146101635780635c56f842146101995780637659faf0146103475780637e43d563146103ac578063976d6e92146103fa578063990e4073146104125780639f2ce6781461042a578063b7609b4414610447578063b9f48c0714610468578063c3a06e7a14610480578063e4ef275914610548575b600080fd5b3480156100d557600080fd5b506100e4600435602435610593565b604080519586526020860194909452848401929092521515606084015215156080830152519081900360a00190f35b6040805160206004803580820135601f810184900484028501840190955284845261016194369492936024939284019190819084018382808284375094975050933594506105e49350505050565b005b34801561016f57600080fd5b50610187600435600160a060020a03602435166108a6565b60408051918252519081900360200190f35b3480156101a557600080fd5b506101b16004356108f9565b60408051600160a060020a03808d168252606082018a90526080820189905260a0820188905286151560c0830152851660e082015290602082019082016101008301610120840185600281111561020457fe5b60ff16815260200184810384528d818151815260200191508051906020019080838360005b83811015610241578181015183820152602001610229565b50505050905090810190601f16801561026e5780820380516001836020036101000a031916815260200191505b5084810383528c5181528c516020918201918e019080838360005b838110156102a1578181015183820152602001610289565b50505050905090810190601f1680156102ce5780820380516001836020036101000a031916815260200191505b50848103825286518152865160209182019188019080838360005b838110156103015781810151838201526020016102e9565b50505050905090810190601f16801561032e5780820380516001836020036101000a031916815260200191505b509d505050505050505050505050505060405180910390f35b34801561035357600080fd5b5061035c610b01565b60408051602080825283518183015283519192839290830191858101910280838360005b83811015610398578181015183820152602001610380565b505050509050019250505060405180910390f35b6040805160206004803580820135601f81018490048402850184019095528484526101619436949293602493928401919081908401838280828437509497505093359450610b5b9350505050565b34801561040657600080fd5b50610161600435610dfe565b34801561041e57600080fd5b50610187600435610e76565b34801561043657600080fd5b506101616004356024351515610e95565b34801561045357600080fd5b50610187600160a060020a0360043516611120565b34801561047457600080fd5b5061035c600435611132565b6040805160206004803580820135601f810184900484028501840190955284845261016194369492936024939284019190819084018382808284375050604080516020601f89358b018035918201839004830284018301909452808352979a99988101979196509182019450925082915084018382808284375050604080516020601f89358b018035918201839004830284018301909452808352979a9998810197919650918201945092508291508401838280828437509497506111c89650505050505050565b34801561055457600080fd5b5061056f600435602435600160a060020a0360443516611545565b6040518082600281111561057f57fe5b60ff16815260200191505060405180910390f35b6003602052816000526040600020818154811015156105ae57fe5b60009182526020909120600590910201805460018201546002830154600390930154919450925060ff8082169161010090041685565b6000806005548034101515156105f957600080fd5b6000848152600160205260409020548490600160a060020a0316151561061e57600080fd5b60008581526001602052604090206008015485906101009004600160a060020a03161561064a57600080fd5b86600080826040516020018082805190602001908083835b602083106106815780518252601f199092019160209182019101610662565b6001836020036101000a0380198251168184511680821785525050505050509050019150506040516020818303038152906040526040518082805190602001908083835b602083106106e45780518252601f1990920191602091820191016106c5565b51815160209384036101000a600019018019909216911617905260408051929094018290039091203360009081529182905292902054919550909350508315915081905061073157508082145b151561073c57600080fd5b896040516020018082805190602001908083835b6020831061076f5780518252601f199092019160209182019101610750565b6001836020036101000a0380198251168184511680821785525050505050509050019150506040516020818303038152906040526040518082805190602001908083835b602083106107d25780518252601f1990920191602091820191016107b3565b6001836020036101000a03801982511681845116808217855250505050505090500191505060405180910390209750600160008a6000191660001916815260200190815260200160002096508760008033600160a060020a0316600160a060020a031681526020019081526020016000208160001916905550338760080160016101000a815481600160a060020a030219169083600160a060020a03160217905550600187600a0160006101000a81548160ff0219169083600281111561089557fe5b021790555050505050505050505050565b6000828152600160205260408120548390600160a060020a031615156108cb57600080fd5b50506000918252600160209081526040808420600160a060020a039390931684526005909201905290205490565b600160208181526000928352604092839020805481840180548651600261010097831615979097026000190190911695909504601f8101859004850286018501909652858552600160a060020a03909116949193929091908301828280156109a25780601f10610977576101008083540402835291602001916109a2565b820191906000526020600020905b81548152906001019060200180831161098557829003601f168201915b50505060028085018054604080516020601f6000196101006001871615020190941695909504928301859004850281018501909152818152959695945090925090830182828015610a345780601f10610a0957610100808354040283529160200191610a34565b820191906000526020600020905b815481529060010190602001808311610a1757829003601f168201915b5050505060038301546004840154600785015460088601546009870180546040805160206002610100600186161581026000190190951604601f8101829004820283018201909352828252999a9799969850949660ff85169692909404600160a060020a0316949291830182828015610aee5780601f10610ac357610100808354040283529160200191610aee565b820191906000526020600020905b815481529060010190602001808311610ad157829003601f168201915b505050600a909301549192505060ff168a565b60606002805480602002602001604051908101604052809291908181526020018280548015610b5057602002820191906000526020600020905b81548152600190910190602001808311610b3b575b505050505090505b90565b60008181526001602052604081205481908390600160a060020a03161515610b8257600080fd5b84600080826040516020018082805190602001908083835b60208310610bb95780518252601f199092019160209182019101610b9a565b6001836020036101000a0380198251168184511680821785525050505050509050019150506040516020818303038152906040526040518082805190602001908083835b60208310610c1c5780518252601f199092019160209182019101610bfd565b51815160209384036101000a6000190180199092169116179052604080519290940182900390912033600090815291829052929020549195509093505083159150819050610c6957508082145b1515610c7457600080fd5b60065434811115610c8457600080fd5b600088815260016020526040902060080154889060ff1615610ca557600080fd5b896040516020018082805190602001908083835b60208310610cd85780518252601f199092019160209182019101610cb9565b6001836020036101000a0380198251168184511680821785525050505050509050019150506040516020818303038152906040526040518082805190602001908083835b60208310610d3b5780518252601f199092019160209182019101610d1c565b51815160209384036101000a6000190180199092169116179052604080519290940182900390912060008f815260018352848120338252818452858220839055600581019093529390932054929c509a505015159150610dcc9050576006870180546001810182556000918252602090912001805473ffffffffffffffffffffffffffffffffffffffff1916331790555b505033600090815260058601602052604090208054349081019091556004909501805490950190945550505050505050565b6000818152600160205260408120548290600160a060020a03161515610e2357600080fd5b600083815260016020526040902060088101549092506101009004600160a060020a03163314610e5257600080fd5b6001600a83015460ff166002811115610e6757fe5b14610e7157600080fd5b505050565b6002805482908110610e8457fe5b600091825260209091200154905081565b600082815260016020526040812054819081908590600160a060020a03161515610ebe57600080fd5b60008681526001602052604090206008015486906101009004600160a060020a03161515610eeb57600080fd5b60008781526001602081905260409091209550600a86015460ff166002811115610f1157fe5b14610f1b57600080fd5b600885015460ff161515610f5057600785018054600101908190556000888152600360205260409020610f4e9082611636565b505b60078501546000888152600360205260409020805460001990920195509085908110610f7857fe5b600091825260208220600590910201935033600090815260048501602052604090205460ff166002811115610fa957fe5b14610fb357600080fd5b6003830154610100900460ff1615610fca57600080fd5b600885015460ff161515610ff95760088501805460ff1916600117905560068501546002900460010160028401555b851561106f578254600190810184553360009081526004850160205260409020805460ff19169091179055600283015483541061106a5760038301805460ff1961ff00199091166101001781166001908117909255600a870180546002939192169083021790555061106a856115ba565b611117565b6001838101805490910181553360009081526004850160205260409020805460ff191660029081179091558401549054106111175760038301805460ff1961ff00199091166101001716905560088501805474ffffffffffffffffffffffffffffffffffffffff00191690556040805160208101918290526000908190526110fb916009880191611662565b50600a8501805460ff1990811690915560088601805490911690555b50505050505050565b60006020819052908152604090205481565b6000818152600160205260409020546060908290600160a060020a0316151561115a57600080fd5b600083815260016020908152604091829020600601805483518184028101840190945280845290918301828280156111bb57602002820191906000526020600020905b8154600160a060020a0316815260019091019060200180831161119d575b5050505050915050919050565b60008060006004548034101515156111df57600080fd5b86600080826040516020018082805190602001908083835b602083106112165780518252601f1990920191602091820191016111f7565b6001836020036101000a0380198251168184511680821785525050505050509050019150506040516020818303038152906040526040518082805190602001908083835b602083106112795780518252601f19909201916020918201910161125a565b51815160209384036101000a60001901801990921691161790526040805192909401829003909120336000908152918290529290205491955090935050831591508190506112c657508082145b15156112d157600080fd5b896040516020018082805190602001908083835b602083106113045780518252601f1990920191602091820191016112e5565b6001836020036101000a0380198251168184511680821785525050505050509050019150506040516020818303038152906040526040518082805190602001908083835b602083106113675780518252601f199092019160209182019101611348565b6001836020036101000a0380198251168184511680821785525050505050509050019150506040518091039020965042878a600143034060405160200180858152602001846000191660001916815260200183805190602001908083835b602083106113e45780518252601f1990920191602091820191016113c5565b51815160209384036101000a6000190180199092169116179052920193845250604080518085038152938201908190528351939650945084935085019190508083835b602083106114465780518252601f199092019160209182019101611427565b51815160209384036101000a60001901801990921691161790526040805192909401829003909120600081815260019092529290208054929a50985050600160a060020a031615915061149a905057600080fd5b33600081815260208181526040909120899055865473ffffffffffffffffffffffffffffffffffffffff1916909117865589516114df916001880191908c0190611662565b5087516114f590600287019060208b0190611662565b505050505060038101829055600a01805460ff19169055600280546001810182556000919091527f405787fa12a823e0f2b7631cc41b3ba8828b3321ca811111fa75cd3aa3bb5ace015550505050565b6000838152600160205260408120548490600160a060020a0316151561156a57600080fd5b600085815260036020526040902080548590811061158457fe5b60009182526020808320600160a060020a03871684526004600590930201919091019052604090205460ff169150509392505050565b600481015481546002820490818303906115dd90600160a060020a031682611600565b60088401546115fa906101009004600160a060020a031683611600565b50505050565b604051600160a060020a0383169082156108fc029083906000818181858888f19350505050158015610e71573d6000803e3d6000fd5b815481835581811115610e7157600502816005028360005260206000209182019101610e7191906116e0565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106116a357805160ff19168380011785556116d0565b828001600101855582156116d0579182015b828111156116d05782518255916020019190600101906116b5565b506116dc929150611714565b5090565b610b5891905b808211156116dc57600080825560018201819055600282015560038101805461ffff191690556005016116e6565b610b5891905b808211156116dc576000815560010161171a5600a165627a7a72305820daabd3a459c73beb8f69aa8c1fd6df42b7f34fc60722e32fdc7ac860b5776f500029"

//create the contract instance. We can use this instance to publish or connect to a published contract
var Contract = web3.eth.contract(abi);

//create a JS Object (key-value pairs), holding the data we need to publish our contract
var publishData = {
	"from": acc, //the account from which it will be published
	"data": bytecode,
	"gas": 4000000 //gas limit. This should be the same or lower than Ethereum's gas limit
}

//publish the contract, passing a callback that will be called twice. Once when the transaction is sent, and once when it is mined
//the first argument is the constructor argument
Contract.new(publishData, function(err, contractInstance) {
	if(!err) {
		if(contractInstance.address) { //if the contract has an address aka if the transaction is mined
            console.log("New contract address is :", contractInstance.address);
            console.log("Owner is :", acc)
		}
	} else {
		console.error(err); //something went wrong
	}
});
